generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "sqlite"
}

model User {
  id           Int           @id @default(autoincrement())
  email        String        @unique
  passwordHash String
  name         String
  role         String        @default("admin")
  isActive     Boolean       @default(true)
  createdAt    DateTime      @default(now())
  reservations Reservation[] @relation("CreatedBy")
}

model RestaurantTable {
  id           Int           @id @default(autoincrement())
  name         String        @unique
  section      String?
  minCapacity  Int           @default(1)
  maxCapacity  Int           @default(4)
  isActive     Boolean       @default(true)
  sortOrder    Int           @default(0)
  posX         Float?        @default(0)
  posY         Float?        @default(0)
  shape        String?       @default("round")
  width        Float?        @default(8)
  height       Float?        @default(8)
  rotation     Int?          @default(0)
  reservations Reservation[]
}

model Reservation {
  id              Int               @id @default(autoincrement())
  code            String            @unique
  guestName       String
  guestPhone      String
  guestEmail      String?
  guestId         Int?
  guest           Guest?            @relation(fields: [guestId], references: [id])
  partySize       Int
  date            String
  time            String
  endTime         String
  durationMin     Int
  specialRequests String?
  source          String            @default("widget")
  status          String            @default("pending")
  tableId         Int?
  table           RestaurantTable?  @relation(fields: [tableId], references: [id])
  originalTime    String?
  counterExpires  String?
  createdById     Int?
  createdBy       User?             @relation("CreatedBy", fields: [createdById], references: [id])
  approvedAt      DateTime?
  arrivedAt       DateTime?
  seatedAt        DateTime?
  completedAt     DateTime?
  cancelledAt     DateTime?
  remindedAt      DateTime?
  requiresDeposit Boolean           @default(false)
  depositAmount   Int?
  payment         ReservationPayment?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  notifications   NotificationLog[]
}

model Guest {
  id             Int           @id @default(autoincrement())
  phone          String        @unique
  name           String
  email          String?
  vipStatus      String?       @default("regular")
  dietaryNotes   String?
  allergyNotes   String?
  generalNotes   String?
  tags           String?
  totalVisits    Int           @default(0)
  totalNoShows   Int           @default(0)
  totalCovers    Int           @default(0)
  lastVisitDate  String?
  firstVisitDate String?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  reservations   Reservation[]
  waitlistEntries WaitlistEntry[]
}

model Setting {
  key   String @id
  value String
}

model NotificationLog {
  id            Int          @id @default(autoincrement())
  reservationId Int?
  reservation   Reservation? @relation(fields: [reservationId], references: [id])
  channel       String
  recipient     String
  messageType   String
  body          String
  status        String       @default("sent")
  createdAt     DateTime     @default(now())
}

model DayOverride {
  id        Int     @id @default(autoincrement())
  date      String  @unique
  isClosed  Boolean @default(false)
  openTime  String?
  closeTime String?
  maxCovers Int?
  note      String?
}

model ReservationPayment {
  id                    Int         @id @default(autoincrement())
  reservationId         Int         @unique
  reservation           Reservation @relation(fields: [reservationId], references: [id])
  type                  String
  amount                Int
  currency              String      @default("usd")
  stripePaymentIntentId String?
  stripeCustomerId      String?
  status                String      @default("pending")
  capturedAt            DateTime?
  refundedAt            DateTime?
  createdAt             DateTime    @default(now())
  updatedAt             DateTime    @updatedAt
}

model WaitlistEntry {
  id            Int       @id @default(autoincrement())
  guestName     String
  guestPhone    String
  guestEmail    String?
  partySize     Int
  estimatedWait Int?
  status        String    @default("waiting")
  position      Int       @default(0)
  quotedAt      DateTime  @default(now())
  notifiedAt    DateTime?
  seatedAt      DateTime?
  notes         String?
  guestId       Int?
  guest         Guest?    @relation(fields: [guestId], references: [id])
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}
